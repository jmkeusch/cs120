<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <title>Unit 3 | PS4 | APIs</title>
  </head>
  <body>
    <div id="description">
    <H1>Unit 3 PS4 API: Name Origin Guesser</H1>
    <br><br>
        <form>
            <p>Enter a name to view the the probability of nationality!</p>
            <label for="name">Name:</label>
                <input type="text" id="name" name="name">
            <input type="button" id="api1" name="api1" value="Go">
        </form>
        <div id="return1">
            <h3>AJAX Return</h3>
            <p id="p1"></p>
        </div> <br>
        <div id="return2">
            <h3>Fetch Return</h3>
            <p id="p2"></p>
        </div> <br>
        <h2>API Description</h2>
        <p>
            This is an API that provides the probablity an individual is from a specific country based on their name passed as a parameter. 
        </p>

        <h2>Website URL:</h2> <br>
            <p>Website URL: https://api.nationalize.io
            <br>
        </p>

        <h2>Options & Parameters</h2>
            <p>
                name="first" (e.g., https://api.nationalize.io?name=maria)
            </p>

        <h2>API Applications</h2>
            <i>Disclaimer: This API provides probabilities based on emprical data and recommendations in any real-world application would be suggestive at best.</i> 
            <br><br>
            This API could potentially be used in a forensics or law enforcement database for determining information about someone's background if their name is known. <br>
            It could perhaps also be used by an HR department in an HR Information System to gauge diversity or national origin if it is not explicitly collected. 
        </div>

    <script language="javascript">
        //GLOBAL VARS
        object1 = new Object;
        object2 = new Object;

        window.onload=function() {
            btnObj = document.getElementById("api1");
            btnObj.onclick = () => {
                getNats();
                fetchNats();
            }
        }

        function prettyPrint(object, target) {
            if (target == "p1") {
                p = "p1";
            } else if (target == "p2") {
                p = "p2";
            }

            console.log("Designated p is " + p);
            let name = object.name;
            let nats = object.country;
        
            document.getElementById(p).innerHTML += "Name: " + name + "<br>";
            for (let i = 0; i < nats.length; i++) {
                let nat = nats[i].country_id;
                let prob = nats[i].probability;
                //console.log("Country: " + nat + " Prob: " + prob);
                document.getElementById(p).innerHTML +=
                    "Country: " + nat + " Probability: " + prob + "<br>";
            }
        }

        //AJAX retrieve JSON method
        function getNats() {
            var ajaxRequest = new XMLHttpRequest();
            ajaxRequest.onreadystatechange = function() {
                if (ajaxRequest.readyState == 1) {
                    console.log("Established server connection.");
                } else if (ajaxRequest.readyState == 2) {
                    console.log("Request received by server.");
                } else if (ajaxRequest.readyState == 3) {
                    console.log("Processing request...");
                } else if (ajaxRequest.readyState == 4) {
                    console.log("Request complete");
                    if (ajaxRequest.status == 200) {
                        console.log("File successfully loaded");
                        //document.getElementById('p1').innerHTML = ajaxRequest.responseText;
                        response = ajaxRequest.responseText;
                        //str = JSON.stringify(response);
                        object1 = JSON.parse(response);
                        console.log("JSON parsed from AJAX");
                        prettyPrint(object1, p1);
                    } else {
                        console.log("Status error: " + ajaxRequest.status);
                    }
                } else {
                    console.log("Error retrieving data.");
                }
            }
            let name = $('#name').val();
            if (name == "") {
                name = " ";
            }
            console.log(name + " entered");
            ajaxRequest.open('GET',"https://api.nationalize.io?name=" + name);
            ajaxRequest.send();
        }

        //JavaScript fetch method
        function fetchNats() {
            let name = $('#name').val();
            fetch("https://api.nationalize.io?name=" + name, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                },
            })
            .then(response => response.text())
            .then(response => {
                prettyPrint(response, p2);
                console.log(JSON.stringify(response));
            })
        }

    </script>
  </body>
</html>

